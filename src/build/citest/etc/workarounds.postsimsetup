#!/bin/sh
# IBM_PROLOG_BEGIN_TAG
# This is an automatically generated prolog.
#
# $Source: src/build/citest/etc/workarounds.postsimsetup $
#
# IBM CONFIDENTIAL
#
# COPYRIGHT International Business Machines Corp. 2011,2013
#
# p1
#
# Object Code Only (OCO) source materials
# Licensed Internal Code Source Materials
# IBM HostBoot Licensed Internal Code
#
# The source code for this program is not published or otherwise
# divested of its trade secrets, irrespective of what has been
# deposited with the U.S. Copyright Office.
#
# Origin: 30
#
# IBM_PROLOG_END_TAG
##
## Workarounds that are run after start_simics is executed for the first time
##    to setup the sandbox
##

### Example applying a patch to cec-chip files
#echo "+++ Updating something wonderful in a simics file"
#mkdir -p $sb/simu/data/cec-chip/
#cp $BACKING_BUILD/src/simu/data/cec-chip/base_cec_chip_file $sb/simu/data/cec-chip
#patch -p0 $sb/simu/data/cec-chip/base_cec_chip_file $HOSTBOOTROOT/src/build/citest/etc/patches/my_patch_File

echo "+++ Updating actions for Blind Purge (CMVC 876083)"
mkdir -p $sb/simu/data/cec-chip
cp $BACKING_BUILD/src/simu/data/cec-chip/p8_ex.act $sb/simu/data/cec-chip
cp $BACKING_BUILD/src/simu/data/cec-chip/s1_ex.act $sb/simu/data/cec-chip
cat $HOSTBOOTROOT/src/build/citest/etc/patches/p8_ex_l3purge.act >> \
    $sb/simu/data/cec-chip/p8_ex.act
cat $HOSTBOOTROOT/src/build/citest/etc/patches/p8_ex_l3purge.act >> \
    $sb/simu/data/cec-chip/s1_ex.act

echo "+++ Updating POR files for Secure ROM Support (removed with RTC 72729)"
mkdir -p $sb/simu/data/cec-chip/
grep -v 0x02020017 $BACKING_BUILD/src/simu/data/cec-chip/p8_master.por > \
                   $sb/simu/data/cec-chip/p8_master.por
grep -v 0x02020017 $BACKING_BUILD/src/simu/data/cec-chip/p8_slave.por > \
                   $sb/simu/data/cec-chip/p8_slave.por
grep -v 0x02020017 $BACKING_BUILD/src/simu/data/cec-chip/s1_master.por > \
                   $sb/simu/data/cec-chip/s1_master.por
grep -v 0x02020017 $BACKING_BUILD/src/simu/data/cec-chip/s1_slave.por > \
                   $sb/simu/data/cec-chip/s1_slave.por
cat $HOSTBOOTROOT/src/build/citest/etc/patches/p8_master.por >> \
    $sb/simu/data/cec-chip/p8_master.por
cat $HOSTBOOTROOT/src/build/citest/etc/patches/p8_master.por >> \
    $sb/simu/data/cec-chip/p8_slave.por
cat $HOSTBOOTROOT/src/build/citest/etc/patches/p8_master.por >> \
    $sb/simu/data/cec-chip/s1_master.por
cat $HOSTBOOTROOT/src/build/citest/etc/patches/p8_master.por >> \
    $sb/simu/data/cec-chip/s1_slave.por

echo "+++ Updating actions for Thread Count(CMVC 889344)"
mkdir -p $sb/simu/data/cec-chip
cp $BACKING_BUILD/src/simu/data/cec-chip/p8.act $sb/simu/data/cec-chip
cp $BACKING_BUILD/src/simu/data/cec-chip/s1.act $sb/simu/data/cec-chip
patch $sb/simu/data/cec-chip/p8.act \
      $HOSTBOOTROOT/src/build/citest/etc/patches/p8.act_sbe_thread_count_patch
patch $sb/simu/data/cec-chip/s1.act \
      $HOSTBOOTROOT/src/build/citest/etc/patches/s1.act_sbe_thread_count_patch

